# Скачивание внешних изображений товаров

Этот скрипт скачивает все внешние изображения товаров (с внешних URL) и сохраняет их локально в папку `uploads`, затем обновляет записи в базе данных.

## Как использовать

### На сервере (Ubuntu/Linux):

```bash
cd /var/www/siterais
git pull origin main
npm run download-images
```

### Локально (Windows):

```bash
cd C:\Users\rdm\Documents\raisgitsite\siterais
npm run download-images
```

## Что делает скрипт:

1. **Получает все товары** из базы данных
2. **Проверяет каждое изображение**:
   - Если изображение начинается с `http://` или `https://` - это внешнее изображение, его нужно скачать
   - Если изображение начинается с `/uploads/` - оно уже локальное, пропускаем
3. **Скачивает внешние изображения** в папку `uploads/` с уникальными именами (формат: `downloaded-{timestamp}-{random}.{ext}`)
4. **Обновляет базу данных**, заменяя внешние URL на локальные пути (`/uploads/filename.jpg`)
5. **Выводит подробную статистику** по завершению

## Особенности:

- ✅ Автоматически определяет тип файла из Content-Type заголовка
- ✅ Обрабатывает редиректы (301, 302)
- ✅ Задержка 500ms между скачиваниями, чтобы не перегружать серверы
- ✅ Пропускает уже локальные изображения
- ✅ Обрабатывает ошибки: если одно изображение не скачалось, продолжает обработку остальных
- ✅ Обновляет как основное изображение (`image_url`), так и дополнительные (`images[]`)

## Результат:

После выполнения скрипта все внешние изображения будут сохранены локально, и ваш сайт не будет зависеть от внешних источников.

## Важно:

- Убедитесь, что у вас достаточно места на диске для хранения изображений
- Скрипт может занять некоторое время, если товаров много (задержка 500ms между скачиваниями)
- Рекомендуется сделать резервную копию базы данных перед запуском: `npm run backup-db`
